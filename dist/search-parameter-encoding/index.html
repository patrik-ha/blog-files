<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Making URL-parameters compact and sharable | Hammersblog</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.bbdba756.css" as="style"><link rel="preload" href="/assets/js/app.ca4609c4.js" as="script"><link rel="preload" href="/assets/js/2.fff04aeb.js" as="script"><link rel="preload" href="/assets/js/6.906f7106.js" as="script"><link rel="preload" href="/assets/js/5.622d1cbf.js" as="script"><link rel="prefetch" href="/assets/js/10.0cdcf02c.js"><link rel="prefetch" href="/assets/js/11.a891bbe1.js"><link rel="prefetch" href="/assets/js/12.81b1e665.js"><link rel="prefetch" href="/assets/js/13.bcafba6f.js"><link rel="prefetch" href="/assets/js/14.ae14ba10.js"><link rel="prefetch" href="/assets/js/15.70f659a6.js"><link rel="prefetch" href="/assets/js/3.fe14eb08.js"><link rel="prefetch" href="/assets/js/4.65977037.js"><link rel="prefetch" href="/assets/js/7.65c74a64.js"><link rel="prefetch" href="/assets/js/8.f997d2f5.js"><link rel="prefetch" href="/assets/js/9.a022d2db.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bbdba756.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hammersblog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/articles/" class="nav-link">Articles</a></div><div class="nav-item"><a href="/about-me/" class="nav-link">About me</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/articles/" class="nav-link">Articles</a></div><div class="nav-item"><a href="/about-me/" class="nav-link">About me</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="making-url-parameters-compact-and-sharable"><a href="#making-url-parameters-compact-and-sharable" aria-hidden="true" class="header-anchor">#</a> Making URL-parameters compact and sharable</h2> <div data-v-304263cd><div class="row mb-3" data-v-304263cd><div class="col-md" data-v-304263cd><span class="float-left" data-v-304263cd><span aria-label="Calendar Blank Outline icon" role="img" class="material-design-icon calendar-blank-outline-icon" data-v-304263cd><svg fill="currentColor" width="20" height="20" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M19,4H18V2H16V4H8V2H6V4H5C3.89,4 3,4.9 3,6V20C3,21.1 3.9,22 5,22H19C20.1,22 21,21.1 21,20V6C21,4.9 20.1,4 19,4M19,20H5V10H19V20M19,8H5V6H19V8Z"><title>Calendar Blank Outline icon</title></path></svg></span><span class="date" data-v-304263cd>2019-08-22</span></span> <span class="tag float-right" data-v-304263cd><span class="tag" data-v-f7f35af4 data-v-304263cd><span aria-label="Arrange Bring To Front icon" role="img" class="material-design-icon arrange-bring-to-front-icon tag-icon" data-v-f7f35af4><svg fill="currentColor" width="20" height="20" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M2,2H11V6H9V4H4V9H6V11H2V2M22,13V22H13V18H15V20H20V15H18V13H22M8,8H16V16H8V8Z"><title>Arrange Bring To Front icon</title></path></svg></span> <span class="tag-text align-middle" data-v-f7f35af4>frontend</span></span></span><span class="tag float-right" data-v-304263cd><span class="tag" data-v-f7f35af4 data-v-304263cd><span aria-label="Wrench Outline icon" role="img" class="material-design-icon wrench-outline-icon tag-icon" data-v-f7f35af4><svg fill="currentColor" width="20" height="20" viewBox="0 0 24 24" class="material-design-icon__svg"><path d="M22.61,19L13.53,9.91C14.46,7.57 14,4.81 12.09,2.91C9.79,0.61 6.21,0.4 3.66,2.26L7.5,6.11L6.08,7.5L2.25,3.69C0.39,6.23 0.6,9.82 2.9,12.11C4.76,13.97 7.47,14.46 9.79,13.59L18.9,22.7C19.29,23.09 19.92,23.09 20.31,22.7L22.61,20.4C23,20 23,19.39 22.61,19M19.61,20.59L10.15,11.13C9.54,11.58 8.86,11.85 8.15,11.95C6.79,12.15 5.36,11.74 4.32,10.7C3.37,9.76 2.93,8.5 3,7.26L6.09,10.35L10.33,6.11L7.24,3C8.5,2.95 9.73,3.39 10.68,4.33C11.76,5.41 12.17,6.9 11.92,8.29C11.8,9 11.5,9.66 11.04,10.25L20.5,19.7L19.61,20.59Z"><title>Wrench Outline icon</title></path></svg></span> <span class="tag-text align-middle" data-v-f7f35af4>how-to</span></span></span></div></div></div> <div class="tip custom-block"><p>If you're just after a code-example, <a href="https://github.com/patrik-ha/blog-files/blob/92a991ebcde822950f064babd458cace05cf7c09/compact-search-parameters/encoding.ts" title="Code example" target="_blank" rel="noopener noreferrer">you can find that here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Otherwise, happy reading!</p></div> <h3 id="dogs-local-papers-and-hyperlinks"><a href="#dogs-local-papers-and-hyperlinks" aria-hidden="true" class="header-anchor">#</a> Dogs, local papers, and hyperlinks</h3> <p>Imagine this: you are starting a dog-walking buisness to accomodate your expensive (something) habit. You've set up a website for all to use, but you've faced some limitations. You don't have a car, so you only offer to travel to the ten closest towns, walks ranging from one to 30 kilometers, and some smaller options. You publish your website, and start taking your first walks.</p> <p>One day you see that your business has made headlines in a local paper! They wanted to show off how great your dog walking skills are, and want to share your prices for certain walks in their town.</p> <p><img src="/assets/img/newspaper.377b0b5c.jpg" alt="Newspaper-clip" title="Newspaper-clipping"></p> <p>That hyperlink doesn't look too good! All the options are written out in plaintext, and even though that might be easy to set up, it makes the link much longer and much more complicated than it has to be. Luckily your skills are not just limited to dog walking, and you set off creating a solution to keep your search-parameter-links short and compact.</p> <h3 id="bits"><a href="#bits" aria-hidden="true" class="header-anchor">#</a> Bits</h3> <p>For this example we will assume the following search-model:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">SearchModel</span> <span class="token punctuation">{</span>
    <span class="token comment">// each town has a specified id, ranging from 1 to 10</span>
    <span class="token keyword">public</span> town<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token comment">// between 1 and 30</span>
    <span class="token keyword">public</span> range<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token comment">// either true or false</span>
    <span class="token keyword">public</span> bringLeash<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    <span class="token comment">// either true, false, or null</span>
    <span class="token keyword">public</span> bringWater<span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>The key to making these url-parameters more compact is considering each parameter as a binary number, and then concatenating them.
For the pure boolean-value this is easy enough, false as 0 and true as 1. For the nullable boolean-value, we get this relationship:</p> <table><thead><tr><th>Boolean</th> <th>Number</th></tr></thead> <tbody><tr><td>true</td> <td>01</td></tr> <tr><td>false</td> <td>00</td></tr> <tr><td>null</td> <td>10</td></tr></tbody></table> <div class="tip custom-block"><p class="custom-block-title">Why do I need two bits for nullable booleans?</p> <p>The first bit signifies whether the parameter has been given a value. All such parameters can be made nullable at the cost of an extra bit. But it also &quot;wastes&quot; all the permutations where the null-bit is 1 and all the other bits are non-zero. (For example: 1000 and 1011 signify the same parameter-value.)</p></div> <p>For pure integer-values its binary representation is used. The ceiling of the 2-logarithm of the highest possible number signify the number of bits the parameter needs. Simply put, this is because the representation needs to have enough bits available to correctly represent it. Some examples:</p> <table><thead><tr><th>Range (base 10)</th> <th>Bits needed</th> <th>Representable range (base 10)</th></tr></thead> <tbody><tr><td>1-10</td> <td>4</td> <td>0-15</td></tr> <tr><td>1-192</td> <td>8</td> <td>0-255</td></tr> <tr><td>0-7</td> <td>2</td> <td>0-7</td></tr></tbody></table> <h3 id="concatenating-parameter-values-to-create-an-unique-state"><a href="#concatenating-parameter-values-to-create-an-unique-state" aria-hidden="true" class="header-anchor">#</a> Concatenating parameter-values to create an unique state</h3> <p>After all parameters have been assigned a value in binary form, all these values are concatenated into a single binary number. It is important that all these numbers are concatenated in the same order every time, so that the parameters can be read correctly later. This concatenation uniquely identifies the state that our search model is in. Given the search-model set above (and concatenation-order from left to right), here are some examples:</p> <table><thead><tr><th>Town (four bits)</th> <th>Range (five bits)</th> <th>Bring leash (one bit)</th> <th>Bring water (two bits)</th> <th>State as number</th></tr></thead> <tbody><tr><td>4 (0100)</td> <td>4 (00100)</td> <td>false (0)</td> <td>false (00)</td> <td>010000100000</td></tr> <tr><td>6 (0110)</td> <td>30 (11110)</td> <td>true (1)</td> <td>true  (01)</td> <td>011011110101</td></tr> <tr><td>1 (0001)</td> <td>1 (00001)</td> <td>true (1)</td> <td>null  (10)</td> <td>000100001110</td></tr></tbody></table> <h3 id="converting-to-a-more-compact-base"><a href="#converting-to-a-more-compact-base" aria-hidden="true" class="header-anchor">#</a> Converting to a more compact base</h3> <p>Finally, the state-number is made more compact by representing it with a more compact base. In this case, if we were to use base 32 we could represent our state-space using a parameter with length three. If we were to use base 64 we could represent the whole space with only two characters, but we would also need a bigger character-set to be able to accommodate 64 different values for each character. But since the difference between a parameter of length two and three is not that big, we can use base 32 as a means of trading trade parameter length for more customizability when it comes to choosing what characters to put in our parameter.</p> <div class="tip custom-block"><p class="custom-block-title">When to use base 32/64?</p> <p>In this example we could have used base 64 to shorten the length of our parameter by one. In our case this wouldn't have much of an impact, but it could be noticably more compact if you are planning on implementing more complex parameters (or much wider ranges). But it also runs into the issue of needing a character-set that is twice as big, which again could lead to more problems. (which characters to take, how to allocate them in a way that is easy to read, etc.) <a href="https://en.wikipedia.org/wiki/Base32#Advantages" title="Base 32, advantages" target="_blank" rel="noopener noreferrer">If you are interested, you can read more about it here.<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h3 id="choosing-what-characters-to-use"><a href="#choosing-what-characters-to-use" aria-hidden="true" class="header-anchor">#</a> Choosing what characters to use</h3> <p>This is usually an easy choice. We want characters that are not easily mixed (e.g. 0 and O), and preferably all in the same case. A good fit for this is the <a href="https://en.wikipedia.org/wiki/Base32#RFC_4648_Base32_alphabet" title="RFC 4648" target="_blank" rel="noopener noreferrer">RFC 4648<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> character-set, which does all of this.</p> <div class="tip custom-block"><p class="custom-block-title">Padding the state-parameter</p> <p>Since each character in our base 32 charset represents five bits from our state-parameter, we also need to pad the end of our state-string with three trailing zeroes. (This is because we need to evenly divide our parameter into equal chunks of five bits each, which in total requires it to be 15 bits long) This doesn't make our parameter any longer when converted into base 32, but is needed nevertheless. In this case we would also need to remember if we used leading or trailing zeroes, so that we know which &quot;parts&quot; of the state-number is used for padding (and not actually representing any of our parameters).</p></div> <p>Given this character-set, our previous examples would be encoded like this:</p> <table><thead><tr><th>State as binary</th> <th>State as base 32</th></tr></thead> <tbody><tr><td>010000100000(000)</td> <td>ija</td></tr> <tr><td>010000100000(000)</td> <td>n5i</td></tr> <tr><td>010000100000(000)</td> <td>cdq</td></tr></tbody></table> <h3 id="converting-back"><a href="#converting-back" aria-hidden="true" class="header-anchor">#</a> Converting back</h3> <p>As long as you remember which order which the parameters are encoded, converting back is a piece of cake. In order to do this you need to convert the state-parameter from base 32 to binary, separate the bit-chunks in the same way they were concatenated to begin with, and then convert them back to the same representation they originally had.</p> <h3 id="code-example"><a href="#code-example" aria-hidden="true" class="header-anchor">#</a> Code-example</h3> <p>And that's it! Given that you've set it up with the routing-engine that you or your framework uses, you should be good to go!</p> <p>To help you with this, you can check out this example-implementation done in TypeScript. It is based on the example from in this post, but it is easily customizable if you would like to use it on your own.
<a href="https://github.com/patrik-ha/blog-files/blob/92a991ebcde822950f064babd458cace05cf7c09/compact-search-parameters/encoding.ts" title="Code example" target="_blank" rel="noopener noreferrer">You can view it here!<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca4609c4.js" defer></script><script src="/assets/js/2.fff04aeb.js" defer></script><script src="/assets/js/6.906f7106.js" defer></script><script src="/assets/js/5.622d1cbf.js" defer></script>
  </body>
</html>
